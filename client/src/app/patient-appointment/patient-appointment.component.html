<div class="appointments-container">
  <div class="card shadow header-card">
    <div class="card-header header-with-voice">
      <h3>ğŸ“… My Appointments</h3>

      <!-- Voice Booking -->
      <div class="voice-controls">
        <button class="btn-voice" (click)="startVoiceBooking()" [class.listening]="listening">
          <span *ngIf="!listening">ğŸ¤ Voice Book</span>
          <span *ngIf="listening">ğŸ›‘ Listening...</span>
        </button>
        <div class="voice-indicator">
          <small class="transcript">{{ transcript }}</small>
          <small class="feedback" *ngIf="feedbackMsg">{{ feedbackMsg }}</small>
        </div>
      </div>
    </div>

    <!-- Search -->
    <div class="input-group search-bar">
      <input type="text" placeholder="ğŸ” Search by doctor or appointment ID" (input)="searchAppointments($event)" />
    </div>
  </div>

  <!-- Appointment Cards -->
  <div class="appointments-grid">
    <div class="appointment-card" *ngFor="let val of paginatedList$" [@fadeIn]>
      <div class="card-header">
        <div class="profile-badge">
          <img src="assets/doctor.png" alt="Doctor" />
        </div>
        <div>
          <h5>Appointment #{{val.id}}</h5>
          <span class="status" [ngClass]="val.status">{{val.status}}</span>
        </div>
      </div>

      <div class="card-body">
        <p><strong>ğŸ•’ Time:</strong> {{val.appointmentTime | date:'dd-MMM-yyyy hh:mm a':'UTC'}}</p>
        <p><strong>ğŸ‘¨â€âš•ï¸ Doctor:</strong> {{val.doctor.username}} <br>
           <small>{{val.doctor.email}}</small></p>
        <p><strong>ğŸ™â€â™‚ï¸ Patient:</strong> {{val.patient.username}} <br>
           <small>{{val.patient.email}}</small></p>
      </div>

      <div class="qr-section" *ngIf="qrCodes[val.id]">
        <img [src]="'data:image/png;base64,'+qrCodes[val.id]" 
             alt="QR Code" 
             (click)="openQr(qrCodes[val.id])" />
        <p>Click QR to enlarge</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <ul class="pagination">
    <li [class.disabled]="currentPage === 1" (click)="goToPage(1)">
      <a href="javascript:void(0)">Â« First</a>
    </li>
    <li [class.disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
      <a href="javascript:void(0)">â€¹ Prev</a>
    </li>

    <li *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="i + 1 === currentPage"
        (click)="goToPage(i + 1)">
      <a href="javascript:void(0)">{{i + 1}}</a>
    </li>

    <li [class.disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
      <a href="javascript:void(0)">Next â€º</a>
    </li>
    <li [class.disabled]="currentPage === totalPages" (click)="goToPage(totalPages)">
      <a href="javascript:void(0)">Last Â»</a>
    </li>
  </ul>
</div>

<!-- QR Popup -->
<div *ngIf="selectedQr" class="qr-popup">
  <div class="qr-overlay" (click)="selectedQr=null"></div>
  <div class="qr-content animate-popup">
    <img [src]="'data:image/png;base64,'+selectedQr" alt="QR"/>
    <button (click)="selectedQr = null" class="btn btn-danger">Close</button>
  </div>
</div>

<!-- Chatbot -->
<div class="chatbot-icon" (click)="toggleChatbot()">ğŸ’Š</div>

<div class="chatbot-popup" *ngIf="chatbotOpen" [@slideUp]>
  <div class="chat-header">ğŸ¤– Health Assistant</div>
  <div class="chat-body">
    <div *ngFor="let msg of chatMessages" 
         [ngClass]="{'user-msg': msg.sender === 'You', 'bot-msg': msg.sender === 'Bot'}">
      <strong>{{msg.sender}}:</strong> {{msg.text}}
    </div>
  </div>
  <div class="chat-input">
    <input [(ngModel)]="userMessage" placeholder="Ask about fever, back pain..." />
    <button (click)="sendMessage()">Send</button>
  </div>
</div>